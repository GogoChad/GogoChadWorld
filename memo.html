<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>M√©mo - GoGoChad</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
  <style>
    body {
      background: #0a0a0a;
      color: #d1d5db;
      font-family: 'Share Tech Mono', monospace;
    }
    .card {
      background: rgba(0, 0, 0, 0.6);
      border: 1px solid rgba(34,197,94,0.4);
      border-radius: 0.5rem;
      padding: 1.5rem;
      transition: transform 0.3s, box-shadow 0.3s;
    }
    .card:hover {
      transform: translateY(-4px);
      box-shadow: 0 0 15px rgba(34,197,94,0.5);
    }
    .btn-green {
      background: #22c55e;
      color: #000;
      font-weight: bold;
      padding: 0.75rem 1.5rem;
      border-radius: 0.375rem;
      transition: transform 0.3s, box-shadow 0.3s;
    }
    .btn-green:hover {
      transform: scale(1.05);
      box-shadow: 0 0 20px rgba(34,197,94,0.7);
    }
    .mono { font-family: 'Share Tech Mono', monospace; }
    .hidden { display: none; }
  </style>
</head>
<body class="min-h-screen flex flex-col">

  <!-- Header -->
  <header class="p-6 border-b border-green-500/30 flex justify-between items-center">
    <h1 class="text-3xl font-bold text-green-400">üìí M√©mo</h1>
    <nav class="space-x-4">
      <a href="index.html" class="text-green-400 hover:text-green-200">üè† Retour</a>
      <button onclick="askPassword()" id="loginBtn" 
              class="text-green-400 hover:text-green-200">üîë Connexion</button>
    </nav>
  </header>

  <!-- Main content -->
  <main id="app" class="flex-1 p-6 max-w-4xl mx-auto">
    <div class="flex justify-between items-center mb-6">
      <h2 class="text-2xl text-green-300">Mes notes</h2>
      <button id="newMemoBtn" class="btn-green hidden">+ Nouveau m√©mo</button>
    </div>

    <!-- Grid de m√©mos -->
    <div id="memoList" class="grid md:grid-cols-2 gap-6"></div>

    <!-- Vue page individuelle -->
    <div id="pageView" class="hidden"></div>
  </main>

  <!-- Modal ajout / √©dition -->
  <div id="modalAdd" class="hidden fixed inset-0 flex items-center justify-center bg-black bg-opacity-80 z-50">
    <div class="bg-gray-900 border border-green-500 p-6 rounded-lg w-full max-w-2xl relative">
      <button onclick="closeAddModal()" class="absolute top-2 right-2 text-green-400">‚úï</button>
      <h2 id="modalTitle" class="text-xl text-green-400 mb-4">Ajouter un m√©mo</h2>

      <input type="hidden" id="editingId">

      <div class="mb-3">
        <input type="text" id="memoTitle" placeholder="Titre du m√©mo"
          class="w-full p-2 bg-black border border-green-500 rounded mono">
      </div>
      <div class="mb-3">
        <textarea id="memoContent" rows="3" placeholder="R√©sum√© du m√©mo"
          class="w-full p-2 bg-black border border-green-500 rounded mono"></textarea>
      </div>
      <div class="mb-3">
        <textarea id="memoText" rows="10" placeholder="Texte complet de l'article"
          class="w-full p-2 bg-black border border-green-500 rounded mono"></textarea>
      </div>
      <div class="mb-3">
        <label class="inline-flex items-center text-green-400">
          <input type="checkbox" id="publishAsPage" class="mr-2"> Publier en page d√©di√©e
        </label>
      </div>

      <button id="saveMemoBtn" class="btn-green">Enregistrer</button>
    </div>
  </div>

  <!-- Footer -->
  <footer class="p-6 text-center text-gray-500 text-sm border-t border-green-500/30">
    Mode hacker blog ‚Äî GoGoChad M√©mo
  </footer>

<script>
  const PASSWORD = "GogoGamers123@12@59400";

  const memoList = document.getElementById("memoList");
  const modalAdd = document.getElementById("modalAdd");
  const newMemoBtn = document.getElementById("newMemoBtn");
  const saveMemoBtn = document.getElementById("saveMemoBtn");
  const memoTitle = document.getElementById("memoTitle");
  const memoContent = document.getElementById("memoContent");
  const memoText = document.getElementById("memoText");
  const publishAsPage = document.getElementById("publishAsPage");
  const pageView = document.getElementById("pageView");
  const editingId = document.getElementById("editingId");
  const modalTitle = document.getElementById("modalTitle");

  let isLogged = false;

  function askPassword() {
    const pwd = prompt("Mot de passe requis :");
    if (pwd === PASSWORD) {
      isLogged = true;
      newMemoBtn.classList.remove("hidden");
      alert("Connexion r√©ussie ‚úÖ");
      renderMemos(); // re-render pour afficher boutons edit/delete
    } else {
      alert("Mot de passe incorrect üòà");
    }
  }

  function cryptoRandomId() {
    return Math.random().toString(36).substr(2, 9);
  }
  function slugify(text) {
    return text.toString().toLowerCase().replace(/\s+/g, '-').replace(/[^\w-]+/g, '');
  }
  function escapeHtml(text) {
    if (!text) return "";
    return text.replace(/[&<>'"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
  }

  function loadMemos() {
    return JSON.parse(localStorage.getItem("memos") || "[]");
  }
  function saveMemos(arr) {
    localStorage.setItem("memos", JSON.stringify(arr));
  }

  function renderMemos() {
    memoList.innerHTML = "";
    const memos = loadMemos();
    memos.forEach(m => {
      const card = document.createElement("article");
      card.className = "card";
      card.innerHTML = `
        <h3 class="text-xl text-green-400 mb-2">${escapeHtml(m.title || "Sans titre")}</h3>
        <p class="text-gray-300 text-sm leading-relaxed">${escapeHtml(m.content || "")}</p>
        <div class="mt-3 text-xs text-gray-500">Ajout√© le ${new Date(m.date).toLocaleString()}</div>
        ${m.pageSlug ? `<a href="?page=${m.pageSlug}" class="text-green-400 text-sm underline">Voir la page</a>` : ""}
        ${isLogged ? `
          <div class="mt-3 flex space-x-2">
            <button onclick="editMemo('${m.id}')" class="text-yellow-400 text-sm underline">‚úèÔ∏è Modifier</button>
            <button onclick="deleteMemo('${m.id}')" class="text-red-400 text-sm underline">üóë Supprimer</button>
          </div>` : ""}
      `;
      memoList.appendChild(card);
    });
  }

  function addMemo(title, content, text, makePage) {
    const arr = loadMemos();
    const slug = makePage ? slugify(title || "page-" + cryptoRandomId()) : null;
    arr.push({
      id: cryptoRandomId(),
      title,
      content,
      text,
      date: new Date().toISOString(),
      pageSlug: slug
    });
    saveMemos(arr);
    renderMemos();
  }

  function editMemo(id) {
    const memos = loadMemos();
    const m = memos.find(x => x.id === id);
    if (!m) return;

    modalTitle.textContent = "Modifier le m√©mo";
    editingId.value = id;
    memoTitle.value = m.title;
    memoContent.value = m.content;
    memoText.value = m.text;
    publishAsPage.checked = !!m.pageSlug;
    modalAdd.classList.remove("hidden");
  }

  function deleteMemo(id) {
    if (!confirm("Supprimer ce m√©mo ?")) return;
    const memos = loadMemos().filter(m => m.id !== id);
    saveMemos(memos);
    renderMemos();
  }

  function closeAddModal() { modalAdd.classList.add("hidden"); }

  newMemoBtn.addEventListener("click", () => {
    editingId.value = "";
    modalTitle.textContent = "Ajouter un m√©mo";
    memoTitle.value = "";
    memoContent.value = "";
    memoText.value = "";
    publishAsPage.checked = false;
    modalAdd.classList.remove("hidden");
  });

  saveMemoBtn.addEventListener("click", () => {
    const t = memoTitle.value.trim();
    const c = memoContent.value.trim();
    const x = memoText.value.trim();
    const makePage = publishAsPage.checked;
    if (!c && !x) { alert("Le m√©mo est vide"); return; }

    if (editingId.value) {
      // Edition
      const memos = loadMemos();
      const idx = memos.findIndex(m => m.id === editingId.value);
      if (idx > -1) {
        memos[idx].title = t;
        memos[idx].content = c;
        memos[idx].text = x;
        memos[idx].pageSlug = makePage ? slugify(t || "page-" + cryptoRandomId()) : null;
        saveMemos(memos);
      }
    } else {
      // Ajout
      addMemo(t, c, x, makePage);
    }

    closeAddModal();
  });

  function renderPage(slug) {
    const memos = loadMemos();
    const m = memos.find(x => x.pageSlug === slug);
    if (!m) {
      pageView.innerHTML = `<p class="text-red-400">Page introuvable.</p>`;
      pageView.classList.remove("hidden");
      memoList.classList.add("hidden");
      return;
    }
    pageView.innerHTML = `
      <div class="page-view">
        <h1 class="text-3xl text-green-300 mb-2">${escapeHtml(m.title || "Sans titre")}</h1>
        <div class="text-xs text-gray-500 mb-4">Publi√© le ${new Date(m.date).toLocaleString()}</div>
        <p class="text-gray-400 mb-6">${escapeHtml(m.content || "")}</p>
        <article class="prose prose-invert max-w-none">
          <pre style="white-space:pre-wrap" class="mono">${escapeHtml(m.text || "")}</pre>
        </article>
      </div>
    `;
    pageView.classList.remove("hidden");
    memoList.classList.add("hidden");
  }

  function checkPage() {
    const params = new URLSearchParams(location.search);
    const slug = params.get("page");
    if (slug) { renderPage(slug); }
  }

  // Init direct
  renderMemos();
  checkPage();
</script>
</body>
</html>
